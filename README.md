## 과제 체크포인트
### 배포 링크
https://luwbe1.github.io/front_5th_chapter1-2/

### 기본과제

#### 가상돔을 기반으로 렌더링하기

- [x] createVNode 함수를 이용하여 vNode를 만든다.
- [x] normalizeVNode 함수를 이용하여 vNode를 정규화한다.
- [x] createElement 함수를 이용하여 vNode를 실제 DOM으로 만든다.
- [x] 결과적으로, JSX를 실제 DOM으로 변환할 수 있도록 만들었다.

#### 이벤트 위임

- [x] 노드를 생성할 때 이벤트를 직접 등록하는게 아니라 이벤트 위임 방식으로 등록해야 한다
- [x] 동적으로 추가된 요소에도 이벤트가 정상적으로 작동해야 한다
- [x] 이벤트 핸들러가 제거되면 더 이상 호출되지 않아야 한다

### 심화 과제

#### 1) Diff 알고리즘 구현

- [x] 초기 렌더링이 올바르게 수행되어야 한다
- [x] diff 알고리즘을 통해 변경된 부분만 업데이트해야 한다
- [x] 새로운 요소를 추가하고 불필요한 요소를 제거해야 한다
- [x] 요소의 속성만 변경되었을 때 요소를 재사용해야 한다
- [x] 요소의 타입이 변경되었을 때 새로운 요소를 생성해야 한다

#### 2) 포스트 추가/좋아요 기능 구현

- [x] 비사용자는 포스트 작성 폼이 보이지 않는다
- [x] 비사용자는 포스트에 좋아요를 클릭할 경우, 경고 메세지가 발생한다.
- [x] 사용자는 포스트 작성 폼이 보인다.
- [x] 사용자는 포스트를 추가할 수 있다.
- [x] 사용자는 포스트에 좋아요를 클릭할 경우, 좋아요가 토글된다.

## 과제 셀프회고
<!-- 과제에 대한 회고를 작성해주세요 -->
가상돔 개념은 `Vue`와 `React`가 이를 기반으로 만들어진 프레임워크라서 익숙했다. 아무래도 기술면접에서도 자주 나오는 질문 사항이니깐. 
직접적으로 구현하는 건 처음이었는데, 개념적으로 이해하는 것과 실제로 구현하는 것의 차이를 실감했다.
특히 이벤트 핸들러 처리에서 어려움을 많이 겪었다. `createElement`와 `updateElement` 내부에서 이벤트 핸들러를 다루는 부분이 까다로웠다. 가능하면 AI 도구를 사용하지 않고 구현하려 했지만, `VNode`를 정규화하고 생성하는 과정은 비교적 수월했어도, 요소를 실제로 생성하거나 업데이트 하는 과정에선 동작 방식이 명확히 이해되지 않아 결국 AI의 도움을 받았다. 이 점이 아쉬움으로 남는다. 
또한, 테스트 코드에 맞춰 구현하는 과정에서 부족함을 느꼈다. 회사나 개인 프로젝트에서도 테스트 코드 중심의 개발 경험이 적다보니, 디버깅과 요구사항에 맞춘 구현이 아직 서툴다고 느꼈다. 앞으로 직접 테스트 코드를 작성해보면 이런 어려움을 극복할 수 있지 않을까 싶다.


### 기술적 성장
<!-- 예시
- 새로 학습한 개념
- 기존 지식의 재발견/심화
- 구현 과정에서의 기술적 도전과 해결
-->
##### (1) `e.preventDefault();`를 남발하고 다녔는데 어디에 붙이고 어디에는 붙이지 말아야 하는지 알게 되었다.
보통 `<a>` 태그 클릭, `<form>` 제출, `keydown` 등의 기본 동작을 막을 때 사용한다.
그동안 이벤트 핸들러에서는 무조건 `e.preventDefault();`를 호출해야 한다고 생각해서, `onLikeUser(좋아요 기능)`에도 습관적으로 넣었었다. 하지만 `<span>` 태그에는 기본 동작이 없기 때문에 불필요하다는 걸 깨닫고 제거했다.

```
const onLikeUser = () => {
    if (!loggedIn) {
      alert("로그인 후 이용해주세요");
    } else {
      togglePostLike(id);
    }
  };
```
예외적으로 `<a href="#">` 같은 요소로 좋아요 버튼을 만들었다면, 기본 동작(페이지 이동)을 막기 위해 `e.preventDefault();`가 필요하다. 하지만 이번에 `<span>` 태그에 onClick 이벤트를 사용했으므로 제거하는 게 맞다.

##### (2) 컴포넌트 정규화하는 과정에서 children이 `{}`로 나오는 문제를 해결하였다.
🚨 콘솔 출력 예시
```
Object {
  "children": Array [],
  "props": null,
  "type": [Function TestComponent],
}
```

```
// 기존 코드
if (typeof vNode === "function") {
  const renderedVNode = vNode.type(vNode.props);
  return normalizeVNode(renderedVNode);
}
```
`vNode` 자체가 함수형 컴포넌트인지 체크하고, `props`만 넘기고 `children`은 넘겨주지 않았다. 
일부 컴포넌트에서 `children`이 유실될 가능성이 있었다.

```
// 변경된 코드
if (typeof vNode.type === "function") {
  const renderedVNode = vNode.type({
    ...vNode.props,
    children: vNode.children,
  });
  return normalizeVNode(renderedVNode); // 렌더링된 VNode를 다시 정규화
}
```
`vNode.type`이 함수형 컴포넌트인지 체크하고, `props`와 `children`을 둘 다 넘겨주었다.
이제 함수형 컴포넌트에서도 `children`이 정상적으로 유지된다.
결과적으로, 모든 함수형 컴포넌트가 `children`을 올바르게 전달받고 렌더링할 수 있다.


### 코드 품질
<!-- 예시
- 특히 만족스러운 구현
- 리팩토링이 필요한 부분
- 코드 설계 관련 고민과 결정
-->
review로 코멘트 달았습니다.


### 학습 효과 분석
<!-- 예시
- 가장 큰 배움이 있었던 부분
- 추가 학습이 필요한 영역
- 실무 적용 가능성
-->
#### 🔍 테스트 코드 디버깅에서의 어려움
테스트 코드에서 오류가 발생했을 때, 원인을 파악하는 과정이 쉽지 않았다.
각각의 `lib` 폴더 내 개별 테스트들은 정상적으로 통과했지만, 전체적인 이벤트 관리 및 렌더링 관련 테스트에서 문제가 발생했을 때 디버깅이 어려웠다.
예를 들어, **네비게이션의 링크 클릭에서 이벤트 전파를 막았을 때 아무 일도 일어나지 않아야 하는 테스트**에서 예상과 다른 동작이 발생했다.
`stopPropagation()`을 추가하지 않아서 생긴 문제라고 생각했지만... 실제 원인은 이벤트 위임을 관리하는 `eventManager` 코드에서 발생한 문제였다. 
`eventManager` 코드의 개별 단위 테스트에서는 이벤트가 정상적으로 동작해서 문제가 없다고 생각했는데... 꽤나 애먹은 부분이었다.
그래서 이 경험을 통해 **단위 테스트가 통과한다고 해서 모든 코드가 올바르게 동작한다고 안심하면 안 된다**와... **이벤트 흐름을 추적하는 게 중요하다**는 걸 깨달았다. 이벤트 관리하는 부분에서 이해가 부족하니 더더욱 찾기 어려웠는지도 모른다. 전체적인 이벤트 흐름을 고려한 디버깅 역량을 키워야겠다. 

#### 🔍 이벤트 핸들링의 어려움
저번주차에도 이벤트와 render 관리하는 부분의 리팩토링을 하지 못했다... 이번에는 직접적으로 이벤트 관리 때문에 구현 자체에 꽤나 어려움을 겪었다. 어느 시점에 `addEvent`를 하고 `removeEvent`를 해야할지... 각각 `createElement`와 `updateElement`에서 이벤트를 적용하는 부분에서 많은 에러를 만났다.

`createElement`에서는 기존 속성을 신경 쓰지 않고 한 번에 새로운 속성을 추가하는 방식이기 때문에 이벤트 핸들러라면 이제 `addEvent`를 추가하는 방식이다.
반면, `updateElement`에서는 새로운 속성과 기존 속성을 비교하는(diff 함수) 과정이 있기 때문에 변경된 속성만 업데이트 한다. 그래서 이벤트 핸들러 같은 경우엔 기존 이벤트를 `removeEvent`로 제거한 후, 새로운 이벤트를 `addEvent`로 추가하는 방식으로 동작한다.
단순하게 `addEvent` 하고 `removeEvent`를 하면 된다고 생각했는데, 잘못 구현했을 때 중복 이벤트가 발생하는 문제를 경험했다. 
1번 호출되어야 하는 이벤트가 0번 호출되거나, 반대로 2번 호출되는 버그가 발생했다.

그런데 이벤트와 관련된 일련의 과정을 겪으면서 오히려 `createElement`와 `updateElement`의 동작방식도 함께 쉽게 이해할 수 있었다.

#### 🔍 WeakMap을 사용한 이벤트 관리
`WeakMap`이라는 타입은 처음 봤다. 처음엔 단순하게 _"이벤트를 어떻게 관리할까?"_ 고민하다가 `Map`을 사용해 구현했다. 그런데 EventManager 성능 개선을 위해 AI 도구를 활용해 보니 WeakMap을 사용하는 것이 더 적합하다고 추천을 받았다. _"WeakMap이 뭐지?"_ 싶어서 찾아보니 몇 가지 장점이 있었다.

1. Map을 사용하면 요소가 DOM에서 제거되더라도 Map에 참조가 남아있어서 GC가 발생하지 않아 메모리 누수가 생길 수 있다.
2. WeakMap을 사용하면 DOM 요소를 키로 사용할 수 있어, 해당 요소가 제거되면 자동으로 정리 된다.
3. 이벤트 리스너를 등록하고 나중에 제거할 때, WeakMap은 자동으로 정리 되므로 `removeEvent`를 사용하지 않아도 정리된다!

결론적으로, 불필요한 이벤트가 남아 있지 않게 되어서 메모리를 효율적으로 관리할 수 있게 되었다.


### 과제 피드백
<!-- 예시
- 과제에서 모호하거나 애매했던 부분
- 과제에서 좋았던 부분
-->
`React`의 렌더링 방식을 이해하기 위해 Fiber 관련 포스팅을 읽어본 적은 있었지만, 직접 가상돔을 구현해본 적은 없었다.
이번 과제를 통해 `VNode` 생성부터 정규화, 실제 DOM 업데이트까지 직접 구현하면서, `React`가 가상돔을 활용해 렌더링을 최적화하는 방식을 더 깊이 이해할 수 있었다.
특히, `setupEventListeners`를 활용한 이벤트 위임 방식이 흥미로웠다! 이벤트 다루는 거 어렵다...


## 리뷰 받고 싶은 내용
<!--
피드백 받고 싶은 내용을 구체적으로 남겨주세요
모호한 요청은 피드백을 남기기 어렵습니다.

참고링크: https://chatgpt.com/share/675b6129-515c-8001-ba72-39d0fa4c7b62

모호한 요청의 예시)
- 코드 스타일에 대한 피드백 부탁드립니다.
- 코드 구조에 대한 피드백 부탁드립니다.
- 개념적인 오류에 대한 피드백 부탁드립니다.
- 추가 구현이 필요한 부분에 대한 피드백 부탁드립니다.

구체적인 요청의 예시)
- 현재 함수와 변수명을 보면 직관성이 떨어지는 것 같습니다. 함수와 변수를 더 명확하게 이름 지을 수 있는 방법에 대해 조언해주실 수 있나요?
- 현재 파일 단위로 코드가 분리되어 있지만, 모듈화나 계층화가 부족한 것 같습니다. 어떤 기준으로 클래스를 분리하거나 모듈화를 진행하면 유지보수에 도움이 될까요?
- MVC 패턴을 따르려고 했는데, 제가 구현한 구조가 MVC 원칙에 맞게 잘 구성되었는지 검토해주시고, 보완할 부분을 제안해주실 수 있을까요?
- 컴포넌트 간의 의존성이 높아져서 테스트하기 어려운 상황입니다. 의존성을 낮추고 테스트 가능성을 높이는 구조 개선 방안이 있을까요?
-->
- 이번에 처음으로 성능 최적화와 메모리 누수를 고려하며 개발했습니다. `DocumentFragment`나 `WeakMap` 같은 개념을 활용했는데, 다른 코드들도 더 개선할 수 있는 부분이 있을까요? 막상 "여기를 개선해야겠다!" 하고 딱 떠올리기가 어렵습니다. 보통 성능 개선이나 메모리 누수를 해결할 때, 어떤 부분을 중점적으로 살펴보면 좋을까요?
- 조금 추상적인 질문일 수도 있는데... 디버깅할 때 문제가 발생한 부분을 찾는 데 시간이 오래 걸립니다. **DevTools와 console.log**를 함께 사용하고 있는데, 더 효율적으로 문제를 분석하고 해결하는 방법이 있을까요?
- 회사에서 `Vue → React`로의 마이그레이션을 고려 중입니다. `React` 생태계를 잘 알지 못해서 기본적인 라이프사이클과 문법 정도를 공부하고 있는데요. 기술 스택을 선택할 때 러닝 커브도 중요하다고 생각하는데, 혹시 추천하는 라이브러리가 있을까요?
**상태 관리나 CSS 라이브러리** 등 선택지가 너무 많아서 막막한데, 실무에서 활용하기 좋은 기술이나 "이걸 써보면서 익히면 더 재밌다!" 싶은 것들이 있다면 알려주시면 감사하겠습니다!
- **이벤트 핸들러와 렌더링(Render) 과정**에 대한 이해가 아직 부족합니다. 개념을 정리하거나 쉽게 이해할 수 있는 자료가 있을까요? 설명을 들어도 추상적으로 느껴지고, 구현할 때도 확신이 서지 않는 부분이 많습니다. 어떻게 공부하면 더 확실하게 이해할 수 있을까요?
- 회사에서 테스트 코드를 조금이라도 적용해보고 싶습니다. 기능 단위로 작성을 시도해보려 하는데, 테스트 범위를 어느 정도로 설정하는 게 좋을까요? `Jest`를 사용해 작은 단위부터 시작해볼까 하는데, 어떤 방식으로 접근하는 게 효과적일까요?
